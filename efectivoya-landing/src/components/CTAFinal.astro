---
import ButtonCTA from './ButtonCTA.astro';

const ctaCoins = [
  { left: '2%',  cls: 'lg', delay: '0.5s',  dur: '10s',  sway: '12px',  gold: true  },
  { left: '12%', cls: 'sm', delay: '3s',    dur: '7.5s', sway: '-8px',  gold: false },
  { left: '22%', cls: 'md', delay: '1.5s',  dur: '8.5s', sway: '10px',  gold: true  },
  { left: '35%', cls: 'xl', delay: '4.5s',  dur: '9s',   sway: '-14px', gold: false },
  { left: '65%', cls: 'lg', delay: '2s',    dur: '11s',  sway: '16px',  gold: true  },
  { left: '78%', cls: 'md', delay: '0.8s',  dur: '8s',   sway: '-10px', gold: false },
  { left: '88%', cls: 'xl', delay: '5s',    dur: '9.5s', sway: '8px',   gold: true  },
  { left: '96%', cls: 'sm', delay: '2.5s',  dur: '7s',   sway: '-12px', gold: false },
];
---

<section class="cta-section">
  <!-- Background gradient -->
  <div class="cta-bg" aria-hidden="true"></div>

  <!-- Decorative elements -->
  <div class="cta-deco cta-deco-1" aria-hidden="true"></div>
  <div class="cta-deco cta-deco-2" aria-hidden="true"></div>

  <!-- Monedas cayendo con signo $ de una línea -->
  <div class="cta-coins-bg" aria-hidden="true">
    {ctaCoins.map(c => (
      <div
        class={`cta-coin coin-${c.cls}`}
        style={`left:${c.left}; animation-delay:${c.delay}; animation-duration:${c.dur}; --coin-sway:${c.sway};`}
      >
        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="24" cy="24" r="22" fill="#1C1200"/>
          <circle cx="24" cy="24" r="22" fill="none" stroke={c.gold ? '#E09F3C' : '#C8921E'} stroke-width="1.8"/>
          <circle cx="24" cy="24" r="18" fill="none" stroke={c.gold ? 'rgba(224,159,60,0.2)' : 'rgba(200,146,30,0.2)'} stroke-width="1"/>
          <line x1="24" y1="8" x2="24" y2="40" stroke={c.gold ? '#E09F3C' : '#C8921E'} stroke-width="2.6" stroke-linecap="round"/>
          <path d="M33 16C33 12 29 10 24 10C19 10 15 12 15 16C15 21 19 23 24 24C29 25 33 28 33 32C33 36 29 38 24 38C19 38 15 36 15 32"
                stroke={c.gold ? '#E09F3C' : '#C8921E'} stroke-width="2.6" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    ))}
    <!-- Vignette central para proteger la legibilidad del texto -->
    <div class="cta-coins-vignette" aria-hidden="true"></div>
  </div>

  <div class="cta-container">

    <div class="cta-content reveal">
      <span class="section-label">Empieza hoy</span>

      <h2 class="cta-title">
        Tu dinero.<br/>
        <span class="cta-title-accent">Ahora mismo.</span>
      </h2>

      <p class="cta-desc">
        Únete a miles de peruanos que ya gestionan su dinero con EfectivoYa.
        Aprobación en segundos, retiros sin comisión.
      </p>

      <div class="cta-action">
        <ButtonCTA
          href="https://app.efectivoya.net"
          text="Crear cuenta gratis"
          target="_blank"
          variant="primary"
          size="lg"
        />
      </div>

      <p class="cta-trust">
        Sin costo de registro&nbsp;·&nbsp;Retiros sin comisión&nbsp;·&nbsp;Soporte humano
      </p>

      <!-- Store badges -->
      <div class="cta-stores">
        <span class="cta-stores-label">También disponible en</span>
        <div class="cta-store-buttons">
          <a href="#" target="_blank" rel="noopener noreferrer" class="cta-store-btn" aria-label="Descargar en App Store">
            <img src="/stores/appstore.png" alt="App Store" class="cta-store-img" loading="lazy" />
          </a>
          <a href="#" target="_blank" rel="noopener noreferrer" class="cta-store-btn" aria-label="Disponible en Google Play">
            <img src="/stores/playstore.png" alt="Google Play" class="cta-store-img" loading="lazy" />
          </a>
        </div>
      </div>
    </div>

  </div>
</section>

<style>
  .cta-section {
    position: relative;
    padding: clamp(80px, 12vw, 120px) 24px;
    overflow: hidden;
  }

  /* ── Gradient background ── */
  .cta-bg {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      135deg,
      #201F1F 0%,
      #2a1e1b 40%,
      #3a2520 70%,
      #68443C 100%
    );
    opacity: 0.85;
  }

  /* override the bg color set on body */
  .cta-section {
    background: #201F1F;
  }

  /* ── Decorative circles ── */
  .cta-deco {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
  }

  .cta-deco-1 {
    width: 500px;
    height: 500px;
    top: -150px;
    right: -100px;
    background: radial-gradient(circle, rgba(224,159,60,0.08) 0%, transparent 70%);
  }

  .cta-deco-2 {
    width: 400px;
    height: 400px;
    bottom: -120px;
    left: -80px;
    background: radial-gradient(circle, rgba(237,50,58,0.07) 0%, transparent 70%);
  }

  /* ── Container ── */
  .cta-container {
    position: relative;
    z-index: 1;
    max-width: 760px;
    margin: 0 auto;
    text-align: center;
  }

  /* ── Content ── */
  .cta-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
  }

  /* ── Title ── */
  .cta-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(56px, 11vw, 120px);
    color: #fff;
    line-height: 0.92;
    letter-spacing: -0.01em;
    margin-bottom: 24px;
  }

  .cta-title-accent {
    color: #E09F3C;
  }

  /* ── Desc ── */
  .cta-desc {
    font-family: 'Sora', sans-serif;
    font-size: clamp(16px, 2vw, 19px);
    font-weight: 300;
    color: rgba(229,229,229,0.75);
    max-width: 480px;
    line-height: 1.65;
    margin-bottom: 40px;
  }

  /* ── CTA wrapper ── */
  .cta-action {
    margin-bottom: 22px;
  }

  /* ── Trust line ── */
  .cta-trust {
    font-family: 'Sora', sans-serif;
    font-size: 13px;
    font-weight: 400;
    color: rgba(178,179,179,0.55);
    letter-spacing: 0.02em;
    margin-bottom: 32px;
  }

  /* ── Store badges ── */
  .cta-stores {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
  }

  .cta-stores-label {
    font-family: 'Sora', sans-serif;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(178,179,179,0.4);
  }

  .cta-store-buttons {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
  }

  /* ── Shimmer border keyframe ── */
  @keyframes ctaBadgeBeam {
    0%   { background-position: 220% center; }
    100% { background-position: -120% center; }
  }

  .cta-store-btn {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 11px;
    padding: 0;
    border: none;
    background: none;
    overflow: visible;
    transition: transform 0.2s ease;
  }

  .cta-store-btn:hover {
    transform: translateY(-2px);
  }

  /* Same mask trick, phase offset so beams don't sync */
  .cta-store-btn::before {
    content: '';
    position: absolute;
    inset: -1px;
    border-radius: 12px;
    padding: 1px;
    background: linear-gradient(
      90deg,
      rgba(224, 159, 60, 0.18)  0%,
      rgba(224, 159, 60, 0.18) 30%,
      rgba(224, 159, 60, 0.5)  42%,
      rgba(255, 232, 120, 0.85) 50%,
      rgba(224, 159, 60, 0.5)  58%,
      rgba(224, 159, 60, 0.18) 70%,
      rgba(224, 159, 60, 0.18) 100%
    );
    background-size: 300% 100%;
    animation: ctaBadgeBeam 3.5s ease-in-out infinite;
    animation-delay: -1.75s;
    -webkit-mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    pointer-events: none;
    z-index: 1;
  }

  .cta-store-img {
    height: 62px;
    width: auto;
    max-width: 200px;
    display: block;
    object-fit: contain;
    border-radius: 11px;
    position: relative;
    z-index: 0;
  }

  /* ── Coins background ── */
  .cta-coins-bg {
    position: absolute;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
    z-index: 0;
  }

  /* Vignette radial: oscurece el centro donde está el texto */
  .cta-coins-vignette {
    position: absolute;
    inset: 0;
    background: radial-gradient(
      ellipse 55% 65% at center,
      rgba(32,31,31,0.78) 0%,
      rgba(32,31,31,0.42) 45%,
      transparent 75%
    );
    pointer-events: none;
  }

  .cta-coin {
    position: absolute;
    top: -90px;
    opacity: 0;
    animation: ctaCoinFall linear infinite;
    animation-fill-mode: backwards;
    filter: drop-shadow(0 0 10px rgba(224,159,60,0.38));
  }

  .cta-coin svg { display: block; width: 100%; height: auto; }

  .cta-coin.coin-sm  { width: 40px; }
  .cta-coin.coin-md  { width: 56px; }
  .cta-coin.coin-lg  { width: 70px; }
  .cta-coin.coin-xl  { width: 88px; }

  @keyframes ctaCoinFall {
    0%   { top: -90px; opacity: 0;    transform: rotate(-6deg) translateX(0); }
    8%   {              opacity: 0.62; }
    50%  {                              transform: rotate(4deg) translateX(var(--coin-sway, 12px)); }
    88%  {              opacity: 0.28; }
    100% { top: calc(100% + 30px); opacity: 0; transform: rotate(10deg) translateX(0); }
  }
</style>
